{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///home/duwa/Git/Naratel-Devops-Dashboard/src/app/api/manifest/next-id/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport fs from 'fs';\nimport path from 'path';\nimport os from 'os';\n\nexport async function GET() {\n  const repoDirName = 'manifest-repo-workdir';\n  const repoPath = path.join(os.tmpdir(), repoDirName);\n  const appsDir = path.join(repoPath, 'apps');\n  \n  let maxId = 0;\n  \n  // If repo hasn't been cloned yet, start with 001\n  if (!fs.existsSync(appsDir)) {\n    return NextResponse.json({ nextId: \"001\" });\n  }\n\n  try {\n    const folders = fs.readdirSync(appsDir);\n    \n    for (const folder of folders) {\n      const valuesPath = path.join(appsDir, folder, 'values.yaml');\n      if (fs.existsSync(valuesPath)) {\n        const content = fs.readFileSync(valuesPath, 'utf8');\n        // Simple regex to find \"id: \"001\"\" or \"id: 001\"\n        const match = content.match(/id:\\s*[\"']?(\\d+)[\"']?/);\n        if (match && match[1]) {\n          const id = parseInt(match[1]);\n          if (id > maxId) maxId = id;\n        }\n      }\n    }\n  } catch (error) {\n    console.error(\"Error reading next-id:\", error);\n  }\n  \n  const nextId = String(maxId + 1).padStart(3, '0');\n  return NextResponse.json({ nextId });\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe;IACpB,MAAM,cAAc;IACpB,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,wGAAE,CAAC,MAAM,IAAI;IACxC,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,UAAU;IAEpC,IAAI,QAAQ;IAEZ,iDAAiD;IACjD,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,UAAU;QAC3B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,QAAQ;QAAM;IAC3C;IAEA,IAAI;QACF,MAAM,UAAU,wGAAE,CAAC,WAAW,CAAC;QAE/B,KAAK,MAAM,UAAU,QAAS;YAC5B,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,SAAS,QAAQ;YAC9C,IAAI,wGAAE,CAAC,UAAU,CAAC,aAAa;gBAC7B,MAAM,UAAU,wGAAE,CAAC,YAAY,CAAC,YAAY;gBAC5C,gDAAgD;gBAChD,MAAM,QAAQ,QAAQ,KAAK,CAAC;gBAC5B,IAAI,SAAS,KAAK,CAAC,EAAE,EAAE;oBACrB,MAAM,KAAK,SAAS,KAAK,CAAC,EAAE;oBAC5B,IAAI,KAAK,OAAO,QAAQ;gBAC1B;YACF;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;IAC1C;IAEA,MAAM,SAAS,OAAO,QAAQ,GAAG,QAAQ,CAAC,GAAG;IAC7C,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE;IAAO;AACpC"}}]
}